<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Car Inventory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
      body {
        background-color: #121212;
        color: #f5f5f5;
      }

      h2,
      h3 {
        color: #ffa500;
        text-shadow: 1px 1px 2px black;
      }

      .table {
        background-color: #1e1e1e;
        color: white;
      }

      .table th {
        background-color: #ff9900 !important;
        color: black;
      }

      .table td {
        vertical-align: middle;
      }

      .form-label {
        color: #f5f5f5;
      }

      .form-select {
        background-color: #2a2a2a;
        color: white;
        border: 1px solid #ffa500;
      }

      .form-select:focus {
        border-color: #ffd700;
        box-shadow: 0 0 0 0.25rem rgba(255, 215, 0, 0.25);
      }

      .btn-primary {
        background-color: #ff6a00;
        border: none;
      }

      .btn-primary:hover {
        background-color: #ffaa00;
        color: black;
      }

      .btn-danger {
        background-color: #ff3b3b;
        border: none;
      }

      .btn-danger:hover {
        background-color: #ff7b7b;
      }

      .card {
        background-color: #1e1e1e;
        border: 1px solid #ffa500;
      }

      /* Navbar tweaks */
      .navbar-nav .nav-link {
        color: white !important;
      }

      .navbar-nav .nav-link:hover {
        color: #ffd700 !important;
      }

      .btn-custom-orange {
        background-color: rgb(160, 115, 2);
        color: white;
      }

      .btn-custom-orange:hover {
        background-color: #ffb200;
        color: black;
      }

      .table {
        background-color: #000000;
        color: #ffffff;
        border-color: #ffffff;
      }

      .table th,
      .table td {
        background-color: #000000 !important;
        color: #ffffff;
        border: 1px solid #ffffff;
      }

      .table th {
        font-weight: bold;
      }

      .table-hover tbody tr:hover {
        background-color: #1a1a1a;
      }
    </style>
  </head>

  <body>
    <!-- navbar starting -->
    <section>
      <nav class="navbar navbar-expand-lg" style="background-color: rgb(0, 0, 0)">
        <div class="container-fluid">
          <img src="images/logo.png" alt="Main Logo" style="height: 5vw" />
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="index.html" style="margin-left: 160px; margin-top: 5px; font-family: Trebuchet MS">HOME</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="carInventory.html" style="margin-top: 5px; margin-left: 15px; font-family: Trebuchet MS">CAR INVENTARY</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="booking.html" style="margin-top: 5px; margin-left: 10px; font-family: Trebuchet MS">BOOKING</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="customers.html" style="margin-top: 5px; margin-left: 10px; font-family: Trebuchet MS">ADD CUSTOMER</a>
            </li>
            <li class="nav-item">
              <a href="join.html">
                <button type="button" class="btn btn-custom-orange" style="margin-top: 3px; margin-left: 25px; height: 45px; width: 110px; border-radius: 5px; font-size: large">
                  <b>Join Now</b>
                </button>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </section>
    <!-- navbar ending -->

    <div class="container py-5">
      <h2>Car Inventory</h2>

      <table class="table table-bordered mt-3" id="carTable">
        <thead class="table-dark">
          <tr>
            <th>Make</th>
            <th>Model</th>
            <th>Color</th>
            <th>Transmission</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3 class="mt-5">Add New Car</h3>
      <form id="addCarForm" class="card p-3 shadow-sm mt-3">
        <div class="row">
          <div class="col-md-3 mb-3">
            <label for="makeSelect" class="form-label">Make</label>
            <select class="form-select" id="makeSelect" required></select>
          </div>
          <div class="col-md-3 mb-3">
            <label for="modelSelect" class="form-label">Model</label>
            <select class="form-select" id="modelSelect" required></select>
          </div>
          <div class="col-md-3 mb-3">
            <label for="colorSelect" class="form-label">Color</label>
            <select class="form-select" id="colorSelect" required></select>
          </div>
          <div class="col-md-3 mb-3">
            <label for="transmissionSelect" class="form-label">Transmission</label>
            <select class="form-select" id="transmissionSelect" required></select>
          </div>
        </div>
        <button class="btn btn-primary w-100" type="submit">Add Car</button>
      </form>
    </div>

    <script>
      const API = "http://localhost:3000";
      const tableBody = document.querySelector("#carTable tbody");

      function loadCars() {
        fetch(`${API}/cars`)
          .then((res) => res.json())
          .then((cars) => {
            tableBody.innerHTML = "";
            cars.forEach((car) => {
              const row = `
                <tr>
                  <td>${car.make_id?.name || "N/A"}</td>
                  <td>${car.model_id?.name || "N/A"}</td>
                  <td>${car.color || "N/A"}</td>
                  <td>${car.transmission_type_id?.name || "N/A"}</td>
                  <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteCar('${car._id}')">Delete</button>
                  </td>
                </tr>`;
              tableBody.innerHTML += row;
            });
          })
          .catch((err) => console.error("Error loading cars:", err));
      }

      function deleteCar(id) {
        if (confirm("Are you sure you want to delete this car?")) {
          fetch(`${API}/cars/${id}`, { method: "DELETE" })
            .then(() => loadCars())
            .catch((err) => console.error("Error deleting car:", err));
        }
      }

      function fillSelect(selectId, endpoint) {
        fetch(`${API}/${endpoint}`)
          .then((res) => res.json())
          .then((items) => {
            const select = document.getElementById(selectId);
            select.innerHTML = `<option value="">Select ${endpoint}</option>`;
            items.forEach((item) => {
              const opt = document.createElement("option");
              opt.value = item._id;
              opt.textContent = item.name;
              select.appendChild(opt);
            });
          })
          .catch((err) => console.error(`Error loading ${endpoint}:`, err));
      }

      document.getElementById("addCarForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const newCar = {
          make_id: document.getElementById("makeSelect").value,
          model_id: document.getElementById("modelSelect").value,
          color: document.getElementById("colorSelect").value,
          transmission_type_id: document.getElementById("transmissionSelect").value,
        };

        fetch(`${API}/cars`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newCar),
        })
          .then((res) => {
            if (!res.ok) throw new Error("Failed to add car.");
            return res.json();
          })
          .then(() => {
            loadCars();
            e.target.reset();
          })
          .catch((err) => console.error("Error adding car:", err));
      });

      // Initial load
      fillSelect("makeSelect", "makes");
      fillSelect("modelSelect", "models");
      fillSelect("colorSelect", "colors");
      fillSelect("transmissionSelect", "transmissions");
      loadCars();
    </script>
  </body>
</html>
